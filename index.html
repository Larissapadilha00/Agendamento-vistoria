<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Agendamento de Vistorias</title>
<style>
/* (O mesmo CSS que vocÃª jÃ¡ possui) */
:root {
    --verde-principal: rgb(52, 69, 55);
    --verde-claro: rgb(72, 95, 75);
    --branco: #f5f5f5;
    --cinza: #e0e0e0;
    --vermelho: #e74c3c;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
    background-color: var(--branco);
    font-family: Arial, sans-serif;
    color: var(--verde-principal);
    padding: 20px;
}
h1, h2 { text-align: center; margin-bottom: 20px; }
.card-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
}
.card {
    background-color: var(--verde-principal);
    color: var(--branco);
    padding: 20px;
    border-radius: 12px;
    cursor: pointer;
    width: 180px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: transform 0.3s;
}
.card:hover { transform: scale(1.05); }
.hidden { display: none; }
.selector, .back-button { margin-top: 20px; text-align: center; }
.selector button, .back-button button {
    background-color: var(--verde-claro);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    margin: 5px;
}
.selector button:hover, .back-button button:hover {
    background-color: var(--verde-principal);
}
.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
}
.header-cell {
    font-weight: bold;
    text-align: center;
}
.day-card {
    background-color: var(--cinza);
    padding: 15px;
    border-radius: 8px;
    cursor: pointer;
    text-align: center;
    position: relative;
}
.day-card:hover {
    background-color: var(--verde-claro);
    color: white;
}
.icon-red {
    color: var(--vermelho);
    position: absolute;
    top: 5px;
    right: 5px;
    font-size: 18px;
}
.hour {
    background-color: var(--cinza);
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    text-align: center;
    margin: 5px;
}
.hour:hover {
    background-color: var(--verde-claro);
    color: white;
}
.form {
    margin-top: 20px;
    display: none;
    flex-direction: column;
    gap: 10px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
    background-color: var(--cinza);
    padding: 20px;
    border-radius: 12px;
}
.form input {
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 6px;
}
.form button {
    background-color: var(--verde-principal);
    color: white;
    border: none;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
}
.form button:hover {
    background-color: var(--verde-claro);
}
.no-available {
    color: var(--vermelho);
    text-align: center;
    margin-top: 10px;
}
.week-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 10px;
    margin-top: 20px;
}
</style>
</head>
<body>

<h1>Agendamento de Vistorias</h1>
<div class="card-container" id="collaborators">
    <div class="card" onclick="selectCollaborator('Cleber')">Cleber</div>
    <div class="card" onclick="selectCollaborator('Devilson')">Devilson</div>
</div>

<div class="selector hidden" id="selector">
    <h2 id="selectedCollaborator"></h2>
    <button onclick="showWeek()">Semana</button>
    <button onclick="showMonth()">MÃªs</button>
</div>

<div class="back-button hidden" id="backButton">
    <button onclick="goBack()">â¬… Voltar</button>
</div>

<div class="calendar hidden" id="calendar"></div>
<div class="day-hours hidden" id="dayHours"></div>
<div class="week-view hidden" id="weekView"></div>

<div class="form" id="form">
    <input type="text" id="nome" placeholder="Nome do responsÃ¡vel">
    <input type="text" id="empreendimento" placeholder="Empreendimento">
    <input type="text" id="local" placeholder="Local (Ex: Ap 101)">
    <button onclick="book()">Agendar</button>
</div>

<script>
    const horarios = ["08:00", "09:00", "10:00", "11:00", "13:00", "14:00", "15:00"];
    let selectedCollaborator = '';
    let selectedDate = '';
    let selectedHour = '';
    const agendamentos = {};

    const API_URL = 'https://script.google.com/macros/s/AKfycbyTbrE1lpT1T6UpJyQGaJfnmqx-uSoB9_O3iV2tWicsIh1jmmxMcVBFWLEmqhFU8qXH/exec';

    function selectCollaborator(nome) {
        selectedCollaborator = nome;
        document.getElementById('collaborators').classList.add('hidden');
        document.getElementById('selector').classList.remove('hidden');
        document.getElementById('selectedCollaborator').innerText = `Agendamento - ${nome}`;
    }

    function showMonth() {
        clearScreens();
        const calendar = document.getElementById('calendar');
        calendar.innerHTML = '';
        calendar.classList.remove('hidden');
        document.getElementById('backButton').classList.remove('hidden');

        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        const grid = document.createElement('div');
        grid.className = 'calendar-grid';

        const weekDays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab'];
        for (const day of weekDays) {
            grid.innerHTML += `<div class='header-cell'>${day}</div>`;
        }

        for (let i = 0; i < firstDay; i++) {
            grid.innerHTML += `<div></div>`;
        }

        for (let d = 1; d <= daysInMonth; d++) {
            const dateStr = `${year}-${month + 1}-${d}`;
            const hasAvailable = horarios.some(h => !agendamentos[`${selectedCollaborator}-${dateStr}-${h}`]);
            const icon = hasAvailable ? '' : '<div class="icon-red">ðŸ”´</div>';
            grid.innerHTML += `<div class='day-card' onclick="openDay('${dateStr}')">${icon}${d}</div>`;
        }

        calendar.appendChild(grid);
    }

    function showWeek() {
        clearScreens();
        const weekView = document.getElementById('weekView');
        weekView.innerHTML = '<h2>Semana Atual</h2>';
        weekView.classList.remove('hidden');
        document.getElementById('backButton').classList.remove('hidden');

        const today = new Date();
        const weekDays = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex'];
        const weekDates = [];

        today.setDate(today.getDate() - today.getDay() + 1);
        for (let i = 0; i < 5; i++) {
            const date = new Date(today);
            date.setDate(today.getDate() + i);
            const dateStr = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
            weekDates.push({ label: weekDays[i], dateStr });
        }

        const grid = document.createElement('div');
        grid.className = 'week-grid';

        weekDates.forEach(day => {
            const column = document.createElement('div');
            const header = document.createElement('div');
            header.className = 'header-cell';
            header.innerText = day.label;
            column.appendChild(header);

            let available = false;
            horarios.forEach(hora => {
                const key = `${selectedCollaborator}-${day.dateStr}-${hora}`;
                if (!agendamentos[key]) {
                    available = true;
                    const btn = document.createElement('div');
                    btn.className = 'hour';
                    btn.innerText = hora;
                    btn.onclick = () => selectHour(day.dateStr, hora);
                    column.appendChild(btn);
                }
            });

            if (!available) {
                const noAvailable = document.createElement('div');
                noAvailable.className = 'no-available';
                noAvailable.innerHTML = 'ðŸ”´';
                column.appendChild(noAvailable);
            }

            grid.appendChild(column);
        });

        weekView.appendChild(grid);
    }

    function openDay(dateStr) {
        clearScreens();
        const dayHours = document.getElementById('dayHours');
        dayHours.innerHTML = `<h2>HorÃ¡rios do dia ${dateStr}</h2>`;
        let available = false;

        horarios.forEach(hora => {
            const key = `${selectedCollaborator}-${dateStr}-${hora}`;
            if (!agendamentos[key]) {
                available = true;
                const hourBtn = document.createElement('div');
                hourBtn.className = 'hour';
                hourBtn.innerText = hora;
                hourBtn.onclick = () => selectHour(dateStr, hora);
                dayHours.appendChild(hourBtn);
            }
        });

        if (!available) {
            const noAvailable = document.createElement('div');
            noAvailable.className = 'no-available';
            noAvailable.innerText = 'ðŸ”´ Sem horÃ¡rio disponÃ­vel';
            dayHours.appendChild(noAvailable);
        }

        const back = document.createElement('div');
        back.className = 'back-button';
        back.innerHTML = `<button onclick="showMonth()">â¬… Voltar para o CalendÃ¡rio</button>`;
        dayHours.appendChild(back);

        dayHours.classList.remove('hidden');
    }

    function selectHour(date, hour) {
        selectedDate = date;
        selectedHour = hour;
        document.getElementById('form').style.display = 'flex';
    }

    function book() {
        const nome = document.getElementById('nome').value.trim();
        const empreendimento = document.getElementById('empreendimento').value.trim();
        const local = document.getElementById('local').value.trim();

        if (!nome || !empreendimento || !local) {
            alert('Preencha todos os campos!');
            return;
        }

        const key = `${selectedCollaborator}-${selectedDate}-${selectedHour}`;
        agendamentos[key] = { nome, empreendimento, local };

        sendToSheet({
            colaborador: selectedCollaborator,
            data: selectedDate,
            hora: selectedHour,
            nome,
            empreendimento,
            local
        });

        alert('Agendado com sucesso!');
        document.getElementById('form').style.display = 'none';
        document.getElementById('nome').value = '';
        document.getElementById('empreendimento').value = '';
        document.getElementById('local').value = '';

        clearScreens();
        document.getElementById('selector').classList.remove('hidden');
    }

    function sendToSheet(data) {
        fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(() => {
            console.log('Enviado ao Google Sheets:', data);
        }).catch(err => {
            console.error('Erro ao enviar ao Google Sheets:', err);
        });
    }

    function goBack() {
        clearScreens();
        document.getElementById('selector').classList.remove('hidden');
        document.getElementById('backButton').classList.add('hidden');
    }

    function clearScreens() {
        document.getElementById('calendar').classList.add('hidden');
        document.getElementById('dayHours').classList.add('hidden');
        document.getElementById('weekView').classList.add('hidden');
        document.getElementById('form').style.display = 'none';
    }
</script>

</body>
</html>
